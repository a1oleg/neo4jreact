{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _resultRx = _interopRequireDefault(require(\"./result-rx\"));\n\nvar _session = _interopRequireDefault(require(\"./session\"));\n\nvar _transactionRx = _interopRequireDefault(require(\"./transaction-rx\"));\n\nvar _constants = require(\"./internal/constants\");\n\nvar _txConfig = _interopRequireDefault(require(\"./internal/tx-config\"));\n\nvar _retryLogicRx = _interopRequireDefault(require(\"./internal/retry-logic-rx\"));\n/**\r\n * Copyright (c) 2002-2020 \"Neo4j,\"\r\n * Neo4j Sweden AB [http://neo4j.com]\r\n *\r\n * This file is part of Neo4j.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * A Reactive session, which provides the same functionality as {@link Session} but through a Reactive API.\r\n */\n\n\nvar RxSession = /*#__PURE__*/function () {\n  /**\r\n   * Constructs a reactive session with given default session instance and provided driver configuration.\r\n   *\r\n   * @protected\r\n   * @param {Object} param - Object parameter\r\n   * @param {Session} param.session - The underlying session instance to relay requests\r\n   */\n  function RxSession() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        session = _ref.session,\n        config = _ref.config;\n\n    (0, _classCallCheck2[\"default\"])(this, RxSession);\n    this._session = session;\n    this._retryLogic = _createRetryLogic(config);\n  }\n  /**\r\n   * Creates a reactive result that will execute the  query with the provided parameters and the provided\r\n   * transaction configuration that applies to the underlying auto-commit transaction.\r\n   *\r\n   * @public\r\n   * @param {string} query - Query to be executed.\r\n   * @param {Object} parameters - Parameter values to use in query execution.\r\n   * @param {TransactionConfig} transactionConfig - Configuration for the new auto-commit transaction.\r\n   * @returns {RxResult} - A reactive result\r\n   */\n\n\n  (0, _createClass2[\"default\"])(RxSession, [{\n    key: \"run\",\n    value: function run(query, parameters, transactionConfig) {\n      var _this = this;\n\n      return new _resultRx[\"default\"](new _rxjs.Observable(function (observer) {\n        try {\n          observer.next(_this._session.run(query, parameters, transactionConfig));\n          observer.complete();\n        } catch (err) {\n          observer.error(err);\n        }\n\n        return function () {};\n      }));\n    }\n    /**\r\n     * Starts a new explicit transaction with the provided transaction configuration.\r\n     *\r\n     * @public\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the new transaction.\r\n     * @returns {Observable<RxTransaction>} - A reactive stream that will generate at most **one** RxTransaction instance.\r\n     */\n\n  }, {\n    key: \"beginTransaction\",\n    value: function beginTransaction(transactionConfig) {\n      return this._beginTransaction(this._session._mode, transactionConfig);\n    }\n    /**\r\n     * Executes the provided unit of work in a {@link READ} reactive transaction which is created with the provided\r\n     * transaction configuration.\r\n     * @public\r\n     * @param {function(txc: RxTransaction): Observable} work - A unit of work to be executed.\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the enclosing transaction created by the driver.\r\n     * @returns {Observable} - A reactive stream returned by the unit of work.\r\n     */\n\n  }, {\n    key: \"readTransaction\",\n    value: function readTransaction(work, transactionConfig) {\n      return this._runTransaction(_constants.ACCESS_MODE_READ, work, transactionConfig);\n    }\n    /**\r\n     * Executes the provided unit of work in a {@link WRITE} reactive transaction which is created with the provided\r\n     * transaction configuration.\r\n     * @public\r\n     * @param {function(txc: RxTransaction): Observable} work - A unit of work to be executed.\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the enclosing transaction created by the driver.\r\n     * @returns {Observable} - A reactive stream returned by the unit of work.\r\n     */\n\n  }, {\n    key: \"writeTransaction\",\n    value: function writeTransaction(work, transactionConfig) {\n      return this._runTransaction(_constants.ACCESS_MODE_WRITE, work, transactionConfig);\n    }\n    /**\r\n     * Closes this reactive session.\r\n     *\r\n     * @public\r\n     * @returns {Observable} - An empty reactive stream\r\n     */\n\n  }, {\n    key: \"close\",\n    value: function close() {\n      var _this2 = this;\n\n      return new _rxjs.Observable(function (observer) {\n        _this2._session.close().then(function () {\n          observer.complete();\n        })[\"catch\"](function (err) {\n          return observer.error(err);\n        });\n      });\n    }\n    /**\r\n     * Returns the bookmark received following the last successfully completed query, which is executed\r\n     * either in an {@link RxTransaction} obtained from this session instance or directly through one of\r\n     * the {@link RxSession#run} method of this session instance.\r\n     *\r\n     * If no bookmark was received or if this transaction was rolled back, the bookmark value will not be\r\n     * changed.\r\n     *\r\n     * @public\r\n     * @returns {string}\r\n     */\n\n  }, {\n    key: \"lastBookmark\",\n    value: function lastBookmark() {\n      return this._session.lastBookmark();\n    }\n    /**\r\n     * @private\r\n     */\n\n  }, {\n    key: \"_beginTransaction\",\n    value: function _beginTransaction(accessMode, transactionConfig) {\n      var _this3 = this;\n\n      var txConfig = _txConfig[\"default\"].empty();\n\n      if (transactionConfig) {\n        txConfig = new _txConfig[\"default\"](transactionConfig);\n      }\n\n      return new _rxjs.Observable(function (observer) {\n        try {\n          observer.next(new _transactionRx[\"default\"](_this3._session._beginTransaction(accessMode, txConfig)));\n          observer.complete();\n        } catch (err) {\n          observer.error(err);\n        }\n\n        return function () {};\n      });\n    }\n    /**\r\n     * @private\r\n     */\n\n  }, {\n    key: \"_runTransaction\",\n    value: function _runTransaction(accessMode, work, transactionConfig) {\n      var txConfig = _txConfig[\"default\"].empty();\n\n      if (transactionConfig) {\n        txConfig = new _txConfig[\"default\"](transactionConfig);\n      }\n\n      return this._retryLogic.retry(this._beginTransaction(accessMode, transactionConfig).pipe((0, _operators.flatMap)(function (txc) {\n        return (0, _rxjs.defer)(function () {\n          try {\n            return work(txc);\n          } catch (err) {\n            return (0, _rxjs.throwError)(err);\n          }\n        }).pipe((0, _operators.catchError)(function (err) {\n          return txc.rollback().pipe((0, _operators.concat)((0, _rxjs.throwError)(err)));\n        }), (0, _operators.concat)(txc.commit()));\n      })));\n    }\n  }]);\n  return RxSession;\n}();\n\nexports[\"default\"] = RxSession;\n\nfunction _createRetryLogic(config) {\n  var maxRetryTimeout = config && config.maxTransactionRetryTime ? config.maxTransactionRetryTime : null;\n  return new _retryLogicRx[\"default\"]({\n    maxRetryTimeout: maxRetryTimeout\n  });\n}","map":{"version":3,"sources":["C:/Users/a1ole/Documents/GitHub/neo4jreact/node_modules/neo4j-driver/lib/session-rx.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_classCallCheck2","_createClass2","_rxjs","_operators","_resultRx","_session","_transactionRx","_constants","_txConfig","_retryLogicRx","RxSession","_ref","arguments","length","undefined","session","config","_retryLogic","_createRetryLogic","key","run","query","parameters","transactionConfig","_this","Observable","observer","next","complete","err","error","beginTransaction","_beginTransaction","_mode","readTransaction","work","_runTransaction","ACCESS_MODE_READ","writeTransaction","ACCESS_MODE_WRITE","close","_this2","then","lastBookmark","accessMode","_this3","txConfig","empty","retry","pipe","flatMap","txc","defer","throwError","catchError","rollback","concat","commit","maxRetryTimeout","maxTransactionRetryTime"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\nexports[\"default\"] = void 0;\r\n\r\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\r\n\r\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\r\n\r\nvar _rxjs = require(\"rxjs\");\r\n\r\nvar _operators = require(\"rxjs/operators\");\r\n\r\nvar _resultRx = _interopRequireDefault(require(\"./result-rx\"));\r\n\r\nvar _session = _interopRequireDefault(require(\"./session\"));\r\n\r\nvar _transactionRx = _interopRequireDefault(require(\"./transaction-rx\"));\r\n\r\nvar _constants = require(\"./internal/constants\");\r\n\r\nvar _txConfig = _interopRequireDefault(require(\"./internal/tx-config\"));\r\n\r\nvar _retryLogicRx = _interopRequireDefault(require(\"./internal/retry-logic-rx\"));\r\n\r\n/**\r\n * Copyright (c) 2002-2020 \"Neo4j,\"\r\n * Neo4j Sweden AB [http://neo4j.com]\r\n *\r\n * This file is part of Neo4j.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * A Reactive session, which provides the same functionality as {@link Session} but through a Reactive API.\r\n */\r\nvar RxSession =\r\n/*#__PURE__*/\r\nfunction () {\r\n  /**\r\n   * Constructs a reactive session with given default session instance and provided driver configuration.\r\n   *\r\n   * @protected\r\n   * @param {Object} param - Object parameter\r\n   * @param {Session} param.session - The underlying session instance to relay requests\r\n   */\r\n  function RxSession() {\r\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\r\n        session = _ref.session,\r\n        config = _ref.config;\r\n\r\n    (0, _classCallCheck2[\"default\"])(this, RxSession);\r\n    this._session = session;\r\n    this._retryLogic = _createRetryLogic(config);\r\n  }\r\n  /**\r\n   * Creates a reactive result that will execute the  query with the provided parameters and the provided\r\n   * transaction configuration that applies to the underlying auto-commit transaction.\r\n   *\r\n   * @public\r\n   * @param {string} query - Query to be executed.\r\n   * @param {Object} parameters - Parameter values to use in query execution.\r\n   * @param {TransactionConfig} transactionConfig - Configuration for the new auto-commit transaction.\r\n   * @returns {RxResult} - A reactive result\r\n   */\r\n\r\n\r\n  (0, _createClass2[\"default\"])(RxSession, [{\r\n    key: \"run\",\r\n    value: function run(query, parameters, transactionConfig) {\r\n      var _this = this;\r\n\r\n      return new _resultRx[\"default\"](new _rxjs.Observable(function (observer) {\r\n        try {\r\n          observer.next(_this._session.run(query, parameters, transactionConfig));\r\n          observer.complete();\r\n        } catch (err) {\r\n          observer.error(err);\r\n        }\r\n\r\n        return function () {};\r\n      }));\r\n    }\r\n    /**\r\n     * Starts a new explicit transaction with the provided transaction configuration.\r\n     *\r\n     * @public\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the new transaction.\r\n     * @returns {Observable<RxTransaction>} - A reactive stream that will generate at most **one** RxTransaction instance.\r\n     */\r\n\r\n  }, {\r\n    key: \"beginTransaction\",\r\n    value: function beginTransaction(transactionConfig) {\r\n      return this._beginTransaction(this._session._mode, transactionConfig);\r\n    }\r\n    /**\r\n     * Executes the provided unit of work in a {@link READ} reactive transaction which is created with the provided\r\n     * transaction configuration.\r\n     * @public\r\n     * @param {function(txc: RxTransaction): Observable} work - A unit of work to be executed.\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the enclosing transaction created by the driver.\r\n     * @returns {Observable} - A reactive stream returned by the unit of work.\r\n     */\r\n\r\n  }, {\r\n    key: \"readTransaction\",\r\n    value: function readTransaction(work, transactionConfig) {\r\n      return this._runTransaction(_constants.ACCESS_MODE_READ, work, transactionConfig);\r\n    }\r\n    /**\r\n     * Executes the provided unit of work in a {@link WRITE} reactive transaction which is created with the provided\r\n     * transaction configuration.\r\n     * @public\r\n     * @param {function(txc: RxTransaction): Observable} work - A unit of work to be executed.\r\n     * @param {TransactionConfig} transactionConfig - Configuration for the enclosing transaction created by the driver.\r\n     * @returns {Observable} - A reactive stream returned by the unit of work.\r\n     */\r\n\r\n  }, {\r\n    key: \"writeTransaction\",\r\n    value: function writeTransaction(work, transactionConfig) {\r\n      return this._runTransaction(_constants.ACCESS_MODE_WRITE, work, transactionConfig);\r\n    }\r\n    /**\r\n     * Closes this reactive session.\r\n     *\r\n     * @public\r\n     * @returns {Observable} - An empty reactive stream\r\n     */\r\n\r\n  }, {\r\n    key: \"close\",\r\n    value: function close() {\r\n      var _this2 = this;\r\n\r\n      return new _rxjs.Observable(function (observer) {\r\n        _this2._session.close().then(function () {\r\n          observer.complete();\r\n        })[\"catch\"](function (err) {\r\n          return observer.error(err);\r\n        });\r\n      });\r\n    }\r\n    /**\r\n     * Returns the bookmark received following the last successfully completed query, which is executed\r\n     * either in an {@link RxTransaction} obtained from this session instance or directly through one of\r\n     * the {@link RxSession#run} method of this session instance.\r\n     *\r\n     * If no bookmark was received or if this transaction was rolled back, the bookmark value will not be\r\n     * changed.\r\n     *\r\n     * @public\r\n     * @returns {string}\r\n     */\r\n\r\n  }, {\r\n    key: \"lastBookmark\",\r\n    value: function lastBookmark() {\r\n      return this._session.lastBookmark();\r\n    }\r\n    /**\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"_beginTransaction\",\r\n    value: function _beginTransaction(accessMode, transactionConfig) {\r\n      var _this3 = this;\r\n\r\n      var txConfig = _txConfig[\"default\"].empty();\r\n\r\n      if (transactionConfig) {\r\n        txConfig = new _txConfig[\"default\"](transactionConfig);\r\n      }\r\n\r\n      return new _rxjs.Observable(function (observer) {\r\n        try {\r\n          observer.next(new _transactionRx[\"default\"](_this3._session._beginTransaction(accessMode, txConfig)));\r\n          observer.complete();\r\n        } catch (err) {\r\n          observer.error(err);\r\n        }\r\n\r\n        return function () {};\r\n      });\r\n    }\r\n    /**\r\n     * @private\r\n     */\r\n\r\n  }, {\r\n    key: \"_runTransaction\",\r\n    value: function _runTransaction(accessMode, work, transactionConfig) {\r\n      var txConfig = _txConfig[\"default\"].empty();\r\n\r\n      if (transactionConfig) {\r\n        txConfig = new _txConfig[\"default\"](transactionConfig);\r\n      }\r\n\r\n      return this._retryLogic.retry(this._beginTransaction(accessMode, transactionConfig).pipe((0, _operators.flatMap)(function (txc) {\r\n        return (0, _rxjs.defer)(function () {\r\n          try {\r\n            return work(txc);\r\n          } catch (err) {\r\n            return (0, _rxjs.throwError)(err);\r\n          }\r\n        }).pipe((0, _operators.catchError)(function (err) {\r\n          return txc.rollback().pipe((0, _operators.concat)((0, _rxjs.throwError)(err)));\r\n        }), (0, _operators.concat)(txc.commit()));\r\n      })));\r\n    }\r\n  }]);\r\n  return RxSession;\r\n}();\r\n\r\nexports[\"default\"] = RxSession;\r\n\r\nfunction _createRetryLogic(config) {\r\n  var maxRetryTimeout = config && config.maxTransactionRetryTime ? config.maxTransactionRetryTime : null;\r\n  return new _retryLogicRx[\"default\"]({\r\n    maxRetryTimeout: maxRetryTimeout\r\n  });\r\n}"]},"metadata":{},"sourceType":"script"}